{% extends "forms/base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load forms_tags %}
{% load styled_forms %}


{% block title %}{% firstof MODULE_FORMS_LABEL trans "Forms" %} {% trans "Add" %}{% endblock %}

{% block content %}
    <h1>{% firstof MODULE_FORMS_LABEL trans "Forms" %} {% trans "Add" %}</h1>

    <form id="t-forms-builder-form" class="form-horizontal" action="." method="post">{% csrf_token %}
        {{ form|styled_form }}

        <fieldset id="t-forms-builder-pricing-options" class="hidden">
            <legend>{% trans "Pricing Options" %}</legend>
            {{ formset.management_form }}
            {{ formset|styled_form_set }}
        </fieldset>

        <div class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
                <button type="submit" class="btn btn-primary">{% trans "Add" %} {% firstof MODULE_FORMS_LABEL trans "Form" %}</button>
            </div>
        </div>
    </form>
{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'js/slug.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var $customPaymentFieldset = $('#id_custom_payment'),
                showCustomPaymentFieldset;

            /* Take Payment CHANGE Handler */
            $customPaymentFieldset.change(function () {
                var pricings = $(this).prop('checked');

                $('#t-forms-builder-pricing-options').toggleClass('hidden', !pricings);
                $('.id_payment_methods').toggleClass('hidden', !pricings);
                $('.id_recurring_payment').toggleClass('hidden', !pricings);
            });

            /* Presetting Payment Display */
            showCustomPaymentFieldset = $customPaymentFieldset.prop('checked');
            $('#t-forms-builder-pricing-options').toggleClass('hidden', !showCustomPaymentFieldset);
            $('.id_payment_methods').toggleClass('hidden', !showCustomPaymentFieldset);
            $('.id_recurring_payment').toggleClass('hidden', !showCustomPaymentFieldset);

            var recurring_payment = $('#id_recurring_payment');
            recurring_payment.change(function(){
                rp = $(this).prop('checked');
                if(rp=='checked') {
                    $('.recurring-payment').closest('div.form-field').show();
                }else{
                    $('.recurring-payment').closest('div.form-field').hide();
                }
            });

            /*Presenting recurring payment display */
            if (recurring_payment.prop('checked')){
                $('.recurring-payment').closest('div.form-field').show();
            } else {
                $('.recurring-payment').closest('div.form-field').hide();
            }

        });

        var slugit = new Slugify({
            input_element : 'input#id_title',
            slug_element : 'input#id_slug',
            submit_element : 'input[type="submit"]',
            help: false,
            limit : 150
        });
    </script>
{% endblock %}
