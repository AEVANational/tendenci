{% extends "contacts/base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load base_filters %}
{% load bootstrap_pagination_tags %}
{% load base_tags %}
{% load contact_tags %}
{% load perm_tags %}


{% block title %}
    {% if MODULE_CONTACTS_LABEL_PLURAL %}
        {% blocktrans with label_plural=MODULE_CONTACTS_LABEL_PLURAL %}{{ label_plural }} Search{% endblocktrans %}
    {% else %}
        {% trans "Contacts Search" %}
    {% endif %} - {{ block.super }}
{% endblock %}

{% block content_classes %}{{ block.super }} t-search-view{% endblock %}

{% block content %}
    <h1>
        {% firstof trans SITE_GLOBAL_SITEPRIMARYKEYWORDS trans SITE_GLOBAL_SITEDISPLAYNAME %}
        {% if MODULE_CONTACTS_LABEL_PLURAL %}
            {% blocktrans with label_plural=MODULE_CONTACTS_LABEL_PLURAL %}{{ label_plural }} Search{% endblocktrans %}
        {% else %}
            {% trans "Contacts Search" %}
        {% endif %}
    </h1>

    {% contact_search %}
    {% autopaginate contacts 10 %}

    <h4 class="capitalize">
        {% if MODULE_CONTACTS_LABEL_PLURAL %}
            <em>{% blocktrans with label_plural=MODULE_CONTACTS_LABEL_PLURAL count=paginator.count %}
                {{ count }} {{ label_plural }} Found
            {% endblocktrans %}</em>
        {% else %}
            <em>{% blocktrans with count=paginator.count %}
                {{ count }} Contacts Found
            {% endblocktrans %}</em>
        {% endif %}
    </h4>

    <section>
        {% for contact in contacts %}
            {% has_perm user contacts.view_contact contact as can_view %}
            {% if can_view %}
            <div class="contact-wrap">
                <h2><a href="{% url 'contact' contact.pk %}">{% firstof contact trans "No Name" %}</a></h2>
                <div class="content">{% blocktrans with m=contact.message|linebreaks %}{{ m }}{% endblocktrans %}</div>

                <div class="meta">
                    <div class="submitted">{% blocktrans with contact.create_dt|date:"long" as create_date %} Submitted on {{ create_date }}{% endblocktrans %}</div>
                </div>

                <!-- delete-contact form -->
                <form name="contact-delete" method="POST" action="{% url 'contact.delete' contact.pk %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                </form>

            </div>
            {% endif %}
        {% empty %}
        {% endfor %}
    <section>

    {% paginate %}
{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script type="text/javascript">
        $(document).ready(function(){

            // delete confirmation
            $('.delete').click(function(){
                var delete_contact = confirm('{% trans "Permenantly delete" %} {{ MODULE_CONTACTS_LABEL }}?');    // confirm
                if(delete_contact) $(this).parents('.contact-wrap').find('form[name="contact-delete"]').submit() // delete: if OK
                return false;    // cancel
            });
        });
    </script>
{% endblock %}
