{% extends "directories/base.html" %}
{% load base_filters %}
{% load base_tags %}
{% load directory_tags %}
{% load directory_filters %}


{% block title %}{{ directory.get_title }}{% endblock %}
{% block meta_description %}{{ directory.get_description }}{% endblock %}
{% block meta_keywords %}{{ directory.get_keywords }}{% endblock %}
{% block meta_canonical_url %}<link rel="canonical" href="{{ directory.get_canonical_url }}">{% endblock %}

{% block content %}
    <article id="t-directories-directory-{{ directory.pk }}" class="t-directories-directory">
        <div class="page-header">
            <h1>{{ directory.headline }}</h1>
		   {% if directory.status_detail == 'pending' %}
				<div class="pull-right clearfix">
				{% if directory|is_directory_owner_with_membership:user %}
             	<a href="{% url 'directory.edit' directory.id %}" class="btn btn-default">{% trans "Edit" %}</a>
                {% endif %}
             	{% if request.user.is_superuser %}
		     	<a href="{% url 'directory.approve' directory.id %}" class="btn btn-success">{% trans "Approve it" %}</a>
             	{% endif %}
				</div>
			{% endif %}
        </div>

        <div class="t-directories-directory-body">
            {% if directory.logo %}
                <p class="t-directories-directory-image-container">
                    <img class="t-directories-directory-image" src="{{ directory.get_logo_url }}" alt="{{ directory.headline|truncatechars:123 }}" title="{{ directory.headline|truncatechars:123 }}">
                </p>
            {% endif %}

            {{ directory.body|safe }}

			{% if directory.corpprofile %}
			<p><a href="{% url 'corpmembership.view_profile' directory.corpprofile.id %}">{% trans "View Corp Member Profile" %}</a></p>
			{% endif %}
        </div>

		{% if directory.has_social_media %}
		{% include "directories/include/social_media_links.html" %}
		{% endif %}

        {% include "directories/meta.html" with show_source=True show_contact=True %}
    </article>
    <br />
{% endblock %}

{% block extra_body %}
    {{ block.super }}
<script type="text/javascript">
	$.ajaxSetup({beforeSend: function(xhr, settings){
		 xhr.setRequestHeader('X-CSRFToken',
		                      '{{ csrf_token }}');
	}});

	(function($) {
    $(document).ready(function(){

		var token = $("[name=csrfmiddlewaretoken]").val();

		// cancel request
        $('.cancel').on("click", function(e){
			e.preventDefault();
            var cancel_affiliate_request = confirm('{% trans "Are you sure you want to cancel this request?" %}?');  // confirm
            if(cancel_affiliate_request){ // cancel: if OK
				var request_wrap = $(this).parents('.affiliate-request-wrap');
				var cancel_url = $(this).attr('href');
				
				$.ajax({	
				   	url: cancel_url,
					type: "POST",
					data: {'csrfmiddlewaretoken': token, 'ajax': 'true'}
					}).success(function(msg){
				    	request_wrap.remove();
				  });

			}  // end if
        });

		// delete affiliate from directory
        $('.delete').on("click", function(e){
			e.preventDefault();
            var delete_affiliate = confirm('{% trans "Are you sure you want to remove this affiliate?" %}?');  // confirm
            if(delete_affiliate){ // delete: if OK
				var affiliate_wrap = $(this).parents('.affiliate-wrap');
				var delete_url = $(this).attr('href');
				
				$.ajax({	
				   	url: delete_url,
					type: "POST",
					data: {'csrfmiddlewaretoken': token, 'ajax': 'true'}
					}).success(function(msg){
				    	affiliate_wrap.remove();
				  });

			}  // end if
        });

    });
}(jQuery));
</script>

{% endblock %}


