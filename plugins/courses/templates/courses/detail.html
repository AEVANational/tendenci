{% extends "courses/base.html" %}
{% load i18n %}
{% load base_tags %}
{% load base_filters %}
{% load perm_tags %}
{% load courses_tags %}
{% load tagging_tags %}

{% is_admin user as admin %}

{% block title %}{{ course.title }}{% endblock %}

{% block extra_head %}
{{ block.super }}
{% endblock %}

{% block body %}
{% tags_for_object course as tags %}

<div class="t">
    {% course_nav request.user course %}

    <div class="course-wrap">

        <h1>{{ course.title }}</h1>

		<div class="content">
            <p><b>DEADLINE:</b> {{ course.deadline }}</p>
			{{ course.content|safe }} 
		</div>
        
        <div class="status">
            {% if has_passed %}
                <p>{% trans "Congratulations! You've passed this course!" %}</p>
                <p><a href="{% url courses.certificate course.pk %}">{% trans "View your Certificate" %}</a></p>
            {% else %}
                {% if course.is_closed and not admin %}
                    <p>{% trans "The deadline has passed and this course is now closed." %}</p>
                {% else %}
                    {% if course.deadline_has_passed %}
                        <p>{% trans "The deadline has passed but you may still take the course." %}</p>
                    {% endif %}
                    {% if not attempted %}
                        {% if course.questions.all %}
                            <p><a href="{% url courses.take course.pk %}">{% trans "Take this Course" %}</a></p>
                        {% else %}
                            <p>{% trans "This course does not have any questions yet." %}</p>
                        {% endif %}
                    {% else %}
                        {% if can_retry %}
                            <p><a href="{% url courses.take course.pk %}">{% trans "Retry this Course" %}</a></p>
                        {% else %}
                            {% if retry_time_left %}
                                <p>{% trans "Try again on" %} {{ retry_time_left }}</p>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}
            {% if attempted %}
                <p><a href="{% url courses.completion course.pk %}">{% trans "View Your Course Attempts" %}</a></p>
            {% endif %}
		</div>
        
        {% if admin %}
        <div class="attempts">
            <h2>{% trans "User Attempt History" %}</h2>
			{% for list in course.user_attempts %}
                <div class="attempt">
                    <p>User: {{ list.user.get_full_name }}</p>
                    <p>No. of attempts: {{ list|length }}</p>
                    <p><a href="{% url courses.user_completion course.pk user.pk %}">{% trans "View Course Attempts" %}</a></p>
                </div>
            {% endfor %}
        </div>
        {% endif %}
        
    </div>
</div>
{% endblock %}
