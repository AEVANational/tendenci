{% extends "courses/base.html" %}
{% load styled_forms %}
{% load forms_tags %}
{% load i18n %}

{% block title %}{% firstof MODULE_COURSES_LABEL 'Course' %} {% trans 'Questions Update' %}{% endblock %}

{% block body %}
<div class="t">
    {# courses_nav request.user #}
	 
    <h1>{% firstof MODULE_COURSES_LABEL 'Courses' %} {% trans "Questions Update" %}</h1>

	<div class="course-wrap">
    	<form action="." method="post">{% csrf_token %}
            {{ form.management_form }}
            <div class="forms">
                {{ form|styled_form_set }}
            </div>
            <input type="button" value="Add Question" id="add_form">
        	<input type="submit" value="Save" />
        </form>
    </div>
	
</div>
{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script type="text/javascript">
        //initialize the formset details and events
        total = $("#id_form-TOTAL_FORMS").val();
        function updateElementIndex(el, prefix, ndx){
            var id_regex = new RegExp('(' + prefix + '-\\d+)');
            var replacement = prefix + '-' + ndx;
            if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
            if (el.id) el.id = el.id.replace(id_regex, replacement);
            if (el.name) el.name = el.name.replace(id_regex, replacement);
        }
        $("#add_form").click(function(){
            //get total number of forms
            total = parseInt($("#id_questions-TOTAL_FORMS").val());
            //clone first form
            clone = $($(".form-grouping")[0]).clone();
            if ((total % 2) != 0){ //alternate color
                clone.attr("class", "form-grouping");
            }
            //update id of clone elements
            inputs = $(clone).find('input');
            for(j=0;j<inputs.length;j++){
                $(inputs[j]).val('');
                updateElementIndex(inputs[j], 'questions', total);
            }
            //append clone
            $(".forms").append(clone);
            //update form total number
            $("#id_questions-TOTAL_FORMS").val(total+1);
            return false;
        });
    </script>
{% endblock %}
