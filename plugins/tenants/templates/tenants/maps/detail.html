{% extends "tenants/base.html" %}
{% load file_tags %}
{% load tenant_tags %}
{% load base_filters %}

{% block body %}
{% tenant_nav request.user map %}

<div class="t">
    <div class="map-wrap">
        <p>{{ map.description }}</p>
        <div class="map-photo">
            <img class="map" src="{{ map|size:'900x' }}" alt="{{ map.name }}" usemap="#mapmap" />
            <map name="mapmap">
            {% for tenant in map.tenant_set.all %}

                {% if tenant.line_set.all %}
                <area id="tenant-area-{{ tenant.pk }}" shape="poly" coords="{% for line in tenant.line_set.all %}{{ line.x1 }},{{ line.y1 }}{% if not forloop.last %},{% endif %}{% endfor %}" href="{% url tenants tenant.slug %}" alt="{{ tenant.suite_number }} {{ tenant.name }}" />
                {% endif %}

            {% endfor %}                
            </map>
        </div>

        {% if tenants_by_tag %}
            <table class="tenant-directory">
            {% for tenant_by_tag in tenants_by_tag %}
                <tr><td colspan="4">
                    {% firstof tenant_by_tag.tag_name 'Miscellaneous' %}</td></tr>
                {% for tenant in tenant_by_tag.tenants %}
                    <tr class="tenant-listing" data-tenant-pk="{{ tenant.pk }}">

                        <td class="tenant-number"><a href="{% url tenants tenant.slug %}">
                            {{ tenant.suite_number }}</a></td>

                        <td class="tenant-name">
                        <a href="{% url tenants tenant.slug %}">
                            {{ tenant.name }}</a></td>

                        <td class="tenant-kind">
                            {{ tenant.kind }}
                            <div class="colored-box" 
                            style="background-color:{{ tenant.kind.color }}"></div>
                        </td>

                        <td class="tenant-phone">{{ tenant.phone }}</td>

                    </tr>
                {% endfor %}
            {% endfor %}
            </table>
        {% endif %}

        {% include "tenants/maps/meta.html" %} 
    </div>
</div>
{% endblock body %}

{% block extra_body %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.qtip.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.maphilight.js"></script>

<script type="text/javascript">

    // Use the each() method to gain access to each elements attributes
   $('area').each(function() {
        $(this).qtip({
            content: $(this).attr('alt'),
            style: {
                name: 'dark', // Give it the preset dark style
                border: {
                    width: 0, 
                    radius: 4
                },
                tip: true // Apply a tip at the default tooltip corner
            },
            position: {
                corner: {
                    target: 'topMiddle',
                    tooltip: 'bottomMiddle'
                }
            }
        });
   });

    $('.map').maphilight();

    // tenant-listing links to map area
    $('.tenant-listing').mouseover(function(){
        var pk = $(this).attr('data-tenant-pk');

        var tenant_area = $('#tenant-area-' + pk)
        if(tenant_area) {
            tenant_area.mouseover();
        };
    });

    // tenant-listing links to map area
    $('.tenant-listing').mouseout(function(){
        var pk = $(this).attr('data-tenant-pk');
        $('#tenant-area-' + pk).mouseout();
    });

</script>
{% endblock %}
