{% load base_tags %}
{% load base_filters %}
{% load product_tags %}
{% load perm_tags %}
{% load tagging_tags %}
{% load i18n %}
{% has_perm user products.change_product product as can_edit %}
{% has_perm user products.delete_product product as can_delete %}
{% tags_for_object product as tags %}
<div class="meta {% if not user.is_authenticated and not tags %}anon{% endif %}">
    <div class="meta-left">
        {% if tags %}
            <div class="tags"><strong>Tags: </strong>
                {% for tag in tags %}
                    <a href="{% url products.search %}?q=tag:{{ tag }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        {% if user.is_authenticated %}
            <div class="submitted">
                Created {{ product.create_dt|date:"long" }} by <a href="{{ product.creator.get_absolute_url }}">
                {% if product.creator.first_name %}
                    {{ product.creator.first_name }} {{ product.creator.last_name }}
                {% else %}
                    {{ product.creator }}
                {% endif %}</a>
            </div>

            <div class="submitted">
                Last updated {{ product.update_dt|date:"long" }} by <a href="{{ product.owner.get_absolute_url }}">
                {% if product.owner.first_name %}
                    {{ product.owner.first_name }} {{ product.owner.last_name }}
                {% else %}
                    {{ product.owner }}
                {% endif %}</a>
            </div>
        {% endif %}
        
        {% with product.category_set as product_cat %}
        {% if product_cat.category %}
        <div class="categories">
            <strong>{% trans "Category:" %} </strong><a href="{% url products.search %}?q=category:{{ product_cat.category }}">{{ product_cat.category }}</a>
            {% if product_cat.sub_category %}
                | <strong>{% trans "Sub Category:" %} </strong><a href="{% url products.search %}?q=sub_category:{{ product_cat.sub_category }}">{{ product_cat.sub_category }}</a>
            {% endif %}
        </div>
        {% endif %}
        {% endwith %}

    </div>
    <div class="meta-right">
        <a class="share-link"></a>
        <a href="{% url products.search %}">back to product results</a>
    </div>
</div>

{% if can_edit %}
    <div class="editor-bar">
        <div class="perm-status">
            <ul>
                <li>{% obj_perms product %}</li>
                <li>{% obj_status product %}</li>
            </ul>
        </div>
        <div class="edit-links">
            <ul>
                <li><a class="eventlog-link" href="{% url event_log.search %}?q=app-id:%20products-{{ product.pk }}">Eventlogs</a></li>
                <li><a class="edit-link" href="{% url admin:martins_products_product_change product.pk %}?next={{ request.path }}">Edit</a></li>
                <li>
                    <a class="options-link" href="#">Options <small>&#9650;</small></a>
                    <div class="options-list">
                        <ul>
                            {% if can_delete %}
                                <li>
                                    <a class="delete" href="{% url admin:martins_products_product_delete product.pk %}">Delete</a>
                                </li> 
                            {% endif %} 
                            <li>
                                <li><a href="{% url category.update product.opt_app_label product.opt_module_name product.pk %}">{% trans "Edit Categories" %}</a></li>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div> 
{% endif %}
